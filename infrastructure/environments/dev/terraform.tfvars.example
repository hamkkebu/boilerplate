# ============================================
# Hamkkebu Dev Environment - Free Tier Configuration
# ============================================
# 신규 AWS 계정 (2024.11 이후): t4g.small + db.t4g.micro (Graviton/ARM64)
# 기존 AWS 계정: t2.micro + db.t2.micro (x86_64)
# ============================================
# 사용법:
# 1. 이 파일을 terraform.tfvars로 복사
# 2. 실제 값으로 변경 (특히 rds_master_password!)
# 3. terraform.tfvars는 .gitignore에 추가되어 있음
# ============================================

project_name = "hamkkebu"
environment  = "dev"
aws_region   = "ap-northeast-2"

# ============================================
# VPC
# ============================================
vpc_cidr = "10.0.0.0/16"

# ============================================
# EC2 + K3s Settings (Free Tier)
# ============================================
# 신규 계정: t4g.small (ARM64/Graviton, 750시간/월)
# 기존 계정: t2.micro (x86_64, 750시간/월)
ec2_instance_type    = "t4g.small"
ec2_root_volume_size = 30           # GB (AMI 최소 요구사항)
ec2_key_pair_name    = null         # Bootstrap에서 생성한 Key Pair 이름
allowed_ssh_cidrs    = ["0.0.0.0/0"] # 보안을 위해 특정 IP로 제한 권장
use_elastic_ip       = false        # true면 인스턴스 중지 시 비용 발생

# ============================================
# RDS Settings (Free Tier)
# ============================================
# 신규 계정: db.t4g.micro (ARM64/Graviton, 750시간/월)
# 기존 계정: db.t2.micro (x86_64, 750시간/월)
rds_instance_class          = "db.t4g.micro"
rds_engine_version          = "8.0"
rds_allocated_storage       = 20             # GB (Free Tier: 20GB)
rds_max_allocated_storage   = 0              # 0 = autoscaling 비활성화
rds_initial_db_name         = "hamkkebu"
rds_master_username         = "admin"
rds_master_password         = "YourSecurePassword123!"  # 반드시 변경!
rds_backup_retention_period = 1              # days (Free Tier 제한)
allowed_db_cidrs            = []             # 로컬 개발 시 IP 추가

# ============================================
# GitHub Actions
# ============================================
create_github_actions_user = true

# ============================================
# 예상 월 비용 (AWS Free Tier 12개월)
# ============================================
# - EC2 (t4g.small): $0 (750시간/월 무료)
# - RDS (db.t4g.micro): $0 (750시간/월 무료)
# - EBS (30GB): $0 (30GB까지 무료)
# - 데이터 전송: $0 (15GB/월 무료)
# ============================================
# 총 예상 비용: $0/월 (Free Tier 기간)
#
# * Free Tier 종료 후:
# - EC2 (t4g.small): ~$12/월
# - RDS (db.t4g.micro): ~$12/월
# - Total: ~$24/월
# ============================================

# ============================================
# 배포 후 필수 작업
# ============================================
# 1. EC2에 SSH 접속하여 K3s 설치 완료 확인:
#    ssh -i <key.pem> ec2-user@<public-ip>
#    kubectl get nodes
#
# 2. RDS에 접속하여 서비스별 데이터베이스 생성:
#    mysql -h <rds-endpoint> -u admin -p
#    CREATE DATABASE hamkkebu_auth CHARACTER SET utf8mb4;
#    CREATE DATABASE hamkkebu_ledger CHARACTER SET utf8mb4;
#    CREATE DATABASE hamkkebu_transaction CHARACTER SET utf8mb4;
#
# 3. K8s Secret 생성 (서비스별 DB 접속 정보):
#    kubectl create secret generic auth-db-secret \
#      --from-literal=DB_URL=jdbc:mysql://<rds>:3306/hamkkebu_auth...
# ============================================
