syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.hamkkebu.boilerplate.grpc.transaction";
option java_outer_classname = "TransactionServiceProto";

package transaction;

/**
 * 거래 서비스 (내부 API)
 *
 * Zero-Payload 패턴에서 거래 상세 정보를 조회하기 위한 gRPC 서비스입니다.
 */
service TransactionService {
  /**
   * 거래 ID로 거래 정보 조회
   */
  rpc GetTransaction (GetTransactionRequest) returns (GetTransactionResponse);

  /**
   * 여러 거래 ID로 배치 조회
   */
  rpc GetTransactions (GetTransactionsRequest) returns (GetTransactionsResponse);

  /**
   * 사용자의 거래 목록 조회
   */
  rpc GetUserTransactions (GetUserTransactionsRequest) returns (GetUserTransactionsResponse);
}

// ==================== Request/Response Messages ====================

message GetTransactionRequest {
  int64 transaction_id = 1;
}

message GetTransactionResponse {
  Transaction transaction = 1;
  string error_message = 2;
}

message GetTransactionsRequest {
  repeated int64 transaction_ids = 1;
}

message GetTransactionsResponse {
  repeated Transaction transactions = 1;
  string error_message = 2;
}

message GetUserTransactionsRequest {
  string user_id = 1;
  int32 page = 2;       // 페이지 번호 (0부터 시작)
  int32 page_size = 3;  // 페이지 크기 (기본 20, 최대 100)
}

message GetUserTransactionsResponse {
  repeated Transaction transactions = 1;
  int64 total_count = 2;
  int32 total_pages = 3;
  string error_message = 4;
}

// ==================== Domain Models ====================

message Transaction {
  int64 id = 1;
  string user_id = 2;
  int64 ledger_id = 3;
  string description = 4;
  int64 amount = 5;           // 금액 (센트 단위, Long으로 저장)
  TransactionType type = 6;
  string created_at = 7;      // ISO 8601 format
  string updated_at = 8;
}

enum TransactionType {
  INCOME = 0;
  EXPENSE = 1;
}
