# Kafka 설정 예제
# application.yml 또는 application-{profile}.yml에 추가하세요

spring:
  kafka:
    # Kafka 브로커 주소
    bootstrap-servers: localhost:9092

    # Producer 설정
    producer:
      # Key/Value Serializer
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

      # 성능 최적화
      acks: all                    # 모든 복제본이 응답할 때까지 대기
      retries: 3                   # 재시도 횟수
      batch-size: 16384           # 배치 크기 (bytes)
      linger-ms: 1                # 배치 전송 대기 시간 (ms)
      buffer-memory: 33554432     # 버퍼 메모리 (32MB)
      compression-type: snappy    # 압축 타입 (snappy, gzip, lz4, zstd)

      # 트랜잭션 설정 (필요한 경우)
      # transaction-id-prefix: tx-

    # Consumer 설정
    consumer:
      # Group ID (각 서비스마다 고유한 값 사용)
      group-id: boilerplate-service-group

      # Key/Value Deserializer
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer

      # Offset 관리
      auto-offset-reset: earliest  # earliest: 처음부터, latest: 최신부터
      enable-auto-commit: true     # 자동 커밋
      auto-commit-interval: 1000   # 자동 커밋 간격 (ms)

      # 성능 최적화
      max-poll-records: 100        # 한 번에 가져올 레코드 수
      fetch-min-size: 1            # 최소 fetch 크기 (bytes)
      fetch-max-wait: 500          # 최대 대기 시간 (ms)

      # JSON Deserializer 설정
      properties:
        # SECURITY: "*" 사용 시 Insecure Deserialization 취약점 발생
        # 신뢰할 수 있는 패키지만 명시적으로 지정
        spring.json.trusted.packages: "com.hamkkebu.boilerplate.*"
        spring.json.value.default.type: com.hamkkebu.boilerplate.data.event.BaseEvent

    # Listener 설정
    listener:
      # Acknowledgment 모드
      ack-mode: batch              # manual, batch, record, time, count, count_time

      # 동시성
      concurrency: 3               # 동시 처리 스레드 수

      # 에러 처리
      # type: batch                # single, batch

# 토픽 설정 (참고용)
kafka:
  topics:
    user-events: user.events
    ledger-events: ledger.events
    transaction-events: transaction.events
    notification-events: notification.events

# 로깅 설정
logging:
  level:
    org.apache.kafka: INFO
    org.springframework.kafka: INFO
    com.hamkkebu.boilerplate.listener: DEBUG
    com.hamkkebu.boilerplate.publisher: DEBUG
